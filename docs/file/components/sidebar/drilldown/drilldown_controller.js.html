<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../../">
  <title data-ice="title">components/sidebar/drilldown/drilldown_controller.js | UOIT Virtual Tour API Document</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  
  
  <script src="script/manual.js"></script>
</head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <a data-ice="repoURL" href="https://github.com/wosevision/virtualtour.git" class="repo-url-github">Repository</a>
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-AppConfig">AppConfig</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-AppRun">AppRun</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-componentModule">componentModule</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">aframe/editor</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/components/aframe/editor/editor_controller.js~EditorCtrl.html">EditorCtrl</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/components/aframe/editor/editor_service.js~$aframeEditor.html">$aframeEditor</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-sceneEditor">sceneEditor</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">aframe/scene</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/components/aframe/scene/scene_controller.js~SceneCtrl.html">SceneCtrl</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/components/aframe/scene/scene_service.js~$aframeScene.html">$aframeScene</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-aframeScene">aframeScene</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">components/sidebar/drilldown/drilldown_controller.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">import { forEach } from &apos;angular&apos;;

function selectItem(item) {
	item.selected = (item === this);
}

function deactivateItem(item) {
	// make item inactive but unhide (default state)
	item.active = item.hidden = false;

	// if the item has children...
	if (item.children) {
		// recursively deactivate its children as well
		forEach(item.children, deactivateItem);
	}
}

function toggleItem(item) {
	// compare the current iterated item to &apos;this&apos;
	// make the item active and unhide if same
	// make the item inactive and hide if not
	item.active = (item === this);
	item.hidden = !(item === this);

	// if the item is NOW inactive and has children...
	if (!item.active &amp;&amp; item.children) {
		// ...then deactivateItem() all its children
		forEach(item.children, deactivateItem);
	}
}

class DrilldownCtrl {
	constructor($scope, $element, $compile, $state, $analytics) {
		&apos;ngInject&apos;;
		// save a reference to the $scope
		this.$scope = $scope;
		this.$state = $state;
		this.$element = $element;
		this.$compile = $compile;
		this.$analytics = $analytics;
	}
	$onInit() {
		// this.$scope.toggle = ($event, code, nextLevel) =&gt; {
		this.$scope.toggle = ($event, $sc) =&gt; {
			// prevent click from bubbling up
			$event.stopPropagation();
			// only open drilldown if final level not reached
			if (this.nextLevel !== &apos;scene&apos;) {
				// if clicked item is inactive...
				if (!$sc.item.active) {
					// ...then go up a level, run toggleItem() on every item
					// ...using the clicked item as the context of &apos;this&apos;
					forEach($sc.$parent.children, toggleItem, $sc.item);
				} else {
					// ...otherwise, go up a level and deactivateItem() all
					forEach($sc.$parent.children, deactivateItem);
				}
			} else {
				forEach($sc.$parent.children, selectItem, $sc.item);
			}
			// go to state based on nextLevel prop and item code
			this.$analytics.eventTrack(&apos;click&apos;, { category: &apos;drilldown&apos;, label: [$sc.$parent.code, $sc.item.code].join(&apos;_&apos;) });
			this.$state.go(this.nextLevel, { [this.nextLevel]: $sc.item.code });
		}

		const $content = this.$element.find(&apos;md-content&apos;)[0];
		this.children.forEach((item, index) =&gt; {
			const childScope = this.$scope.$new();
			childScope.item = item;
			this.$compile(`&lt;div
				class=&quot;drilldown-item&quot;
				ng-class=&quot;{ &apos;is-active&apos;: item.active, &apos;is-hidden&apos;: item.hidden }&quot;
				md-ink-ripple=&quot;{{ item.active ? false : &apos;#003C71&apos; }}&quot;
				ng-click=&quot;toggle($event, this)&quot;
				md-autofocus=&quot;${ index === 0 }&quot;&gt;
				&lt;div ng-if=&quot;!item.hidden&quot; style=&quot;padding-right: 30px;&quot; class=&quot;drilldown-content&quot; ng-class=&quot;{&apos;md-caption&apos;: item.active, &apos;md-title&apos;: !item.active, &apos;selected&apos;: item.selected }&quot;&gt;
					&lt;span&gt;{{ ::item.name }}&lt;/span&gt;
					&lt;div class=&quot;open-indicator&quot;&gt;&lt;/div&gt;
				&lt;/div&gt;
				&lt;ui-view ng-if=&quot;item.active&quot; /&gt;
			&lt;/div&gt;`)(childScope, (clone, scope) =&gt; {
				$content.append(clone[0]);
			})
		});
	}
}

export default {
  name: &apos;DrilldownCtrl&apos;,
  fn: DrilldownCtrl
};
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(0.4.8)</span></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
