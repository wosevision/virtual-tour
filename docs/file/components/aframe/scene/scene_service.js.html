<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../../">
  <title data-ice="title">components/aframe/scene/scene_service.js | UOIT Virtual Tour API Document</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  
  
  <script src="script/manual.js"></script>
</head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <a data-ice="repoURL" href="https://github.com/wosevision/virtualtour.git" class="repo-url-github">Repository</a>
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-AppConfig">AppConfig</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-AppRun">AppRun</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-componentModule">componentModule</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">aframe/editor</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/components/aframe/editor/editor_controller.js~EditorCtrl.html">EditorCtrl</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/components/aframe/editor/editor_service.js~$aframeEditor.html">$aframeEditor</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-sceneEditor">sceneEditor</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">aframe/scene</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/components/aframe/scene/scene_controller.js~SceneCtrl.html">SceneCtrl</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/components/aframe/scene/scene_service.js~$aframeScene.html">$aframeScene</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-aframeScene">aframeScene</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">components/aframe/scene/scene_service.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">import { isArray, isObject } from &apos;angular&apos;;

/**
 * The scene service class is the lead orchestrator of the `&lt;aframe-scene/&gt;`
 * component&apos;s business logic. It is the application and component&apos;s main
 * interface to the current scene data.
 *
 * Scene manipulation is accomplished using the `$aframeScene.scene` getter
 * and setter property; internally, the scene data is stored in the service
 * &quot;raw&quot; under the property `sceneData`. The getter and setter are
 * responsible for transliterating changes into the &quot;raw&quot; data object and
 * back again. The setter also sets the `$aframeSky.sky` property, thus kicking
 * off a sky change from its respective service.
 *
 * @param {object} $mdToast        ng-material&apos;s toast service
 * @param {object} $aframeSky			 The sky service
 * @param {object} EDITOR_MESSAGES Constant to define toast configs
 */
class $aframeScene {
	constructor($mdToast, $aframeSky, EDITOR_MESSAGES) {
		&apos;ngInject&apos;;

		this.$mdToast = $mdToast;
		this.$aframeSky = $aframeSky;

		this.toasts = {};
		Object.keys( EDITOR_MESSAGES ).forEach(type =&gt; {
			const toast = $mdToast.simple();
			const toastConfig = EDITOR_MESSAGES[type];
			Object.keys(toastConfig).forEach(prop =&gt; {
				toast[prop]( toastConfig[prop] );
			});
			this.toasts[type] = toast;
		});
	}
	/**
	 * Getter and setter pair for internal scene data.
	 * 
	 * @param  {[Object]} sceneData Incoming scene data to set
	 * @return {[Object]}						The scene&apos;s current data
	 * @example
	 * {
	 *   _id: &apos;583f17cfd2cd0c0400072d9c&apos;,
	 *   parent: &apos;57a8e38b12ad99fe889c95f3&apos;,
	 *   code: &apos;2b&apos;,
	 *   name: &apos;Atrium 2B&apos;,
	 *   hotSpots: [ ... ],
	 *   sceneLinks: [ ... ],
	 *   panorama: { ... }
	 * }
	 */
	get scene() {
		if (this.sceneData) {
			return this.sceneData;
		}
	}
	set scene(sceneData) {
		this.$aframeSky.sky = sceneData.panorama;
		this.sceneData = this.lastPublished = sceneData; // { _id, sceneLinks, hotSpots, sky };
	}

	/**
	 * Method for `Array.splice()`ing items out of scene elements (`sceneLinks`,
	 * `hotSpots`) for removal from the active scene (what is being viewed, not
	 * necessarily what is saved on the server).
	 *
	 * Confirms with the user before deleting, saves a draft after, and
	 * offers to publish once removed (which will commit the changes).
	 *
	 * @example
	 * $aframeScene.removeItemFrom(
	 *   { name: &apos;thing&apos; },
	 *   [{ name: &apos;thing&apos; }, { name: &apos;thung&apos; }, { name: &apos;thong&apos; }],
	 *   () =&gt; this.updateView()
	 * );
	 * // ...results in:
	 * // &gt;&gt; [{ name: &apos;thung&apos; }, { name: &apos;thong&apos; }]
	 * 
	 * @param  {object}   		 item       The item being removed
	 * @param  {Array&lt;Object&gt;} collection The array it will be removed from
	 * @param  {Function} 		 cb         Callback to run when item removed
	 * @return {Promise}									Promise resolves to result of toast
	 */
  removeItemFrom(item, collection, cb) {
    this.$mdToast.show(this.toasts.confirm).then(response =&gt; {
      if ( response == &apos;ok&apos; ) {
			  const index = collection.indexOf(item);
			  if (index !== -1) {
			  	collection.splice(index, 1);
	      	cb&amp;&amp;cb();
	      	return this.$mdToast.show(this.toasts.itemRemoved);
			  } 
      }
    }).then(response =&gt; {
      if ( response == &apos;ok&apos; ) {
      	this.$aframeEditor.publish();
      }
    });
	}

	/**
	 * Method for `Array.push()`ing items onto the list of current scene
	 * elements (`sceneLinks`, `hotSpots`) for display in the scene.
	 *
	 * Checks validity of collection and item; adds item and informs user
	 * of the newly added item&apos;s default position. Offers to publish changes.
	 * 
	 * @param {Object}   			item       The item being added
	 * @param {Array&lt;Object&gt;} collection The array it will be added to
	 * @param {Function}			cb         Callback to run when item added
	 */
	addItemTo(item, collection, cb) {
	  if (isObject(item) &amp;&amp; isArray(collection)) {
	  	collection.push(item)
    	cb&amp;&amp;cb(collection);
    	if (item.position &amp;&amp; item.position.length) {
    		this.toasts.itemAdded.textContent(`Item added at ${ item.position.join(&apos;, &apos;) }!`);
    	}
	    this.$mdToast.show(this.toasts.itemAdded).then(response =&gt; {
	      if ( response == &apos;ok&apos; ) {
			  	this.$aframeEditor.publish();
	      }
	    });
	  }
	}
}

export default $aframeScene;</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(0.4.8)</span></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
